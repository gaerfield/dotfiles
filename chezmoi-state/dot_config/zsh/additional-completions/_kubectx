#compdef kubectx kctx=kubectx

# this script is a replacement from:
#      https://raw.githubusercontent.com/ahmetb/kubectx/master/completion/kubectx.zsh
# error: _arguments:comparguments:325: can only be called from completion function
# https://github.com/ahmetb/kubectx/issues/285

# also kubectx does not work with different kubectx-location

__kubectx() {
  # ${HOME}/.kube/kubectx
  local KUBECTX="/home/blaschke/.cache/zsh/zinit/plugins/ahmetb---kubectx/kubectx"
  PREV=""

  local all_contexts="$(kubectl config get-contexts --output='name')"
  if [ -f "$KUBECTX" ]; then
      # show '-' only if there's a saved previous context
      local PREV=$(cat "${KUBECTX}")

      _arguments \
        "-d:*: :(${all_contexts})" \
        "(- *): :(- ${all_contexts})"
  else
      _arguments \
        "-d:*: :(${all_contexts})" \
        "(- *): :(${all_contexts})"
  fi
}
